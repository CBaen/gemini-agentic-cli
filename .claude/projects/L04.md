# L04: Auto-Discovery Before Research

**Thesis**: `research/system_theses/SUMMARY.md` (L04 section)
**Priority**: High
**Status**: done

## Overview
Add pre-check logic before spawning Gemini research. Avoid duplicate research by checking Qdrant first.

## Thresholds
- **0.9+** = High confidence match → SKIP research, use existing
- **0.75-0.89** = Partial match → Fill gaps only, don't re-research
- **<0.75** = No match → Proceed with new research

## Tasks
- [x] Find current Gemini call points in skills
- [x] Implement pre-check function with thresholds
- [x] Update lineage-research skill with auto-discovery
- [x] Update lineage-consult skill with auto-discovery
- [x] Test and document

## Results

**Changes to `~/.claude/skills/lineage-research/SKILL.md`:**
- Replaced single-tier check (score > 0.8 → STOP) with three-tier logic
- Added STEP 2A for full research (score < 0.75)
- Added STEP 2B for gap-filling research (score 0.75-0.89)
- Updated STEP 3 reporting to include discovery result and action taken

**Changes to `~/.claude/skills/lineage-consult/SKILL.md`:**
- Replaced single-tier check (score > 0.85 → STOP) with three-tier logic
- Added STEP 2A for full consultation (score < 0.75)
- Added STEP 2B for gap-filling consultation (score 0.75-0.89)
- Updated STEP 3 reporting to include discovery result and action taken

**Gap-Filling Prompts:**
- Research: Asks Gemini to review existing coverage, identify gaps, research only missing aspects
- Consult: Asks Gemini to review existing recommendations, provide advice only for gaps

**Testing:**
- JSON output from search script parseable, scores visible
- Score 0.789 correctly identified as partial match range

## Handoff
Complete. Three-tier auto-discovery implemented in both research and consult skills.

---
**Started**: 2026-01-16
**Completed**: 2026-01-16
**Owner**: @claude
