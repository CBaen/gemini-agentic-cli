# L06: Code Indexing for Qdrant

**Thesis**: `research/system_theses/SUMMARY.md` (L06 section)
**Priority**: Medium
**Status**: done

## Overview
Index codebase functions and classes in Qdrant for semantic code search.

## What to Index
- Key functions with docstrings
- Classes with methods
- Common patterns
- NOT: entire codebase, generated code, dependencies

## Tasks
- [x] Create Python AST parser for functions/classes
- [x] Build embedding and Qdrant storage
- [x] Add commit hash tracking
- [x] Create indexing script with parallel embedding
- [x] Test with sample codebase

## Results

**Created: `~/.claude/scripts/qdrant-code-index.py`**

Features:
- Python AST-based extraction of functions and classes
- Parallel embedding with ThreadPoolExecutor (from L01)
- Incremental indexing via file hash tracking
- Commit hash tracking for freshness
- Default exclusions for venv, node_modules, etc.
- Batch storage to Qdrant

Usage:
```bash
# Index a project
python ~/.claude/scripts/qdrant-code-index.py --path /path/to/project --collection code_index

# Dry run (see what would be indexed)
python ~/.claude/scripts/qdrant-code-index.py --path . --collection code_index --dry-run

# Force re-index all files
python ~/.claude/scripts/qdrant-code-index.py --path . --collection code_index --force

# Exclude additional directories
python ~/.claude/scripts/qdrant-code-index.py --path . --collection code_index --exclude "tests,docs"
```

**Testing Results:**
- 18 Python files â†’ 155 code items indexed
- Search found `store_points_batch` with score 0.716
- Full metadata preserved: name, signature, docstring, code, file_path, line numbers

## Schema
```json
{
    "type": "code",
    "kind": "function|class|method",
    "name": "function_name",
    "file_path": "relative/path/to/file.py",
    "file_hash": "abc123",
    "line_start": 10,
    "line_end": 25,
    "signature": "def func(a, b) -> str:",
    "docstring": "...",
    "code": "full source code",
    "imports": ["import os", "from x import y"],
    "module_docstring": "...",
    "commit_hash": "abc123",
    "timestamp": 1234567890
}
```

## Handoff
Complete. Code indexing script created with parallel embedding. Use `qdrant-semantic-search.py` to search indexed code.

---
**Started**: 2026-01-16
**Completed**: 2026-01-16
**Owner**: @claude
