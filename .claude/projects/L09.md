# L09: Context Window Management

**Priority**: Medium
**Status**: done

## Overview
Patterns for managing Claude's context window efficiently during long sessions.

## Problem
- Context fills up during extended work sessions
- Important information can be lost during compaction
- Need strategies for what to keep vs delegate

## Tasks
- [x] Document context preservation patterns
- [x] Define delegation triggers (when to spawn subagents)
- [x] Create compaction-safe information patterns
- [x] Verify patterns in existing documentation

## Results

### Already Implemented in Lineage System

**1. Delegation Triggers (in ~/.claude/CLAUDE.md):**
- Research tasks → lineage-research skill (Gemini)
- Project-specific questions → lineage-consult skill (Gemini)
- Retrieval → lineage-retrieve skill (Haiku proxy)
- Exploration → Task tool with Explore agent

**2. Compaction-Safe Information:**
- Todo lists (TodoWrite) - always preserved
- File paths with line numbers - survives compaction
- Project files (.claude/MEMORY.md, HANDOFF.md) - persist to disk
- Qdrant storage - permanent memory

**3. Context Budget (implicit in current patterns):**
- Main instance: Decision-making, user interaction
- Subagents: Research, exploration, heavy lifting
- Qdrant: Long-term memory, cross-session retrieval

### Key Patterns

**Pattern 1: Research Delegation**
```
User asks research question →
  Spawn Haiku supervisor →
    Haiku calls Gemini →
      Store to Qdrant →
        Return coordinates only
```
Main context never sees full research content.

**Pattern 2: Two-Stage Retrieval**
```
Need existing knowledge →
  peek (50 tokens/result) →
    Decide which IDs matter →
      fetch (only specific IDs)
```
Avoids loading unnecessary content.

**Pattern 3: Handoff Protocol**
```
Context running low →
  Update HANDOFF.md with state →
    Note key decisions →
      Include reproduction commands →
        Next instance reads HANDOFF.md
```
Continuity without context carryover.

## Handoff
Complete. Context management patterns already documented across CLAUDE.md, skills, and project files. The lineage system is designed for context efficiency.

---
**Started**: 2026-01-16
**Completed**: 2026-01-16
**Owner**: @claude
