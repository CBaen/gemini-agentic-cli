# C02: Task Routing Patterns

**Thesis**: Stored in Qdrant (parent_id: c58a07c4-7048-4d5f-abe0-82fe5aac32a4)
**Priority**: High
**Status**: done

## Overview
Decision trees for routing different task types to appropriate Gemini models and accounts.

## Tasks
- [x] Generate thesis via lineage-consult (gemini-3-flash-preview)
- [x] Store to Qdrant (20 chunks, 5,450 words)
- [x] Document key findings

## Consultation Results

**Model**: gemini-3-flash-preview
**Session**: c02-task-routing-2026-01-16
**Parent ID**: c58a07c4-7048-4d5f-abe0-82fe5aac32a4

### Primary Recommendation
Implement a stateful 'Global Routing Registry' that tracks model-specific quotas and account RPMs to perform preemptive load balancing before task dispatch.

### Model Tiering Strategy
- **Gemini 3-Flash-Preview**: Reasoning backbone (complex tasks)
- **Gemini 2.0-Flash**: Operational workhorse (general tasks)
- **Gemini 2.5-Flash-Lite**: Utility layer (simple, high-volume)

### Task Classification (4 buckets)
1. **Atomic Operations** - Simple, fast tasks
2. **Reasoning-Heavy Synthesis** - Complex analysis
3. **Tool-Augmented Execution** - Tasks requiring tools
4. **Contextual Summarization** - Content processing

### Key Routing Patterns

**Multi-Account Rotation**: Round-Robin with Sticky Sessions across two accounts to overcome 60 RPM limits.

**Dynamic Decision Tree**: Top-Down complexity assessment + Bottom-Up quota health checking for real-time model selection.

**Rate Limit Tracking**: Sliding window telemetry and daily quota forecasting.

### Core Chunks
- Task Classification Framework
- Gemini Model Capability Mapping
- Multi-Account Rotation Strategy
- The Decision Tree Logic
- Rate Limit Awareness and Tracking
- Fallback Logic: Model Degradation
- Fallback Logic: Account Switching

### Implementation Phases
1. **Classification & Infrastructure** - SQLite rate-limit tracker, AccountManager
2. **Decision Logic & Fallbacks** - Heuristic decision tree, fallback paths
3. **Optimization & Refinement** - Priority queue, telemetry, verification loops

### Success Criteria
- Zero unhandled 429 errors during 2-hour research sessions
- 95%+ accuracy in model-task matching
- 30% latency reduction via offloading to Flash-Lite

## Retrieval
```bash
python ~/.claude/scripts/qdrant-peek.py fetch -c lineage_research --ids "c58a07c4-7048-4d5f-abe0-82fe5aac32a4"
```

## Handoff
Complete. Task routing patterns stored in Qdrant. Model tiering and fallback logic documented.

---
**Started**: 2026-01-16
**Completed**: 2026-01-16
**Owner**: @claude
